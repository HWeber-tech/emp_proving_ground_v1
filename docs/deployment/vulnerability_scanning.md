# Dependency vulnerability scanning

The High-Impact roadmap calls for integrating vulnerability scanning into CI.
This document describes how to run the new helper `tools/security/pip_audit_runner.py`
and how to manage exemptions responsibly.

## Running the scanner locally

```bash
python -m tools.security.pip_audit_runner \
  --requirement requirements.txt \
  --requirement requirements/requirements.txt \
  --format markdown \
  --output artifacts/security/pip_audit.md
```

The command wraps `pip-audit`, producing Markdown (or JSON with `--format json`).
The CLI exits with status code `1` when actionable vulnerabilities remain and `0`
when the dependency set is clean.

## CI integration

Add the following job to the CI pipeline:

```yaml
- name: Dependency scan
  run: |
    python -m tools.security.pip_audit_runner \
      --requirement requirements.txt \
      --requirement requirements/requirements.txt \
      --output artifacts/security/pip_audit.md
```

Publish `artifacts/security/pip_audit.md` so reviewers can inspect the findings.
Failing the pipeline when vulnerabilities are detected keeps the roadmap’s
"Institutional risk" stream honest.

## Exemption workflow

When a vulnerability cannot be resolved immediately, record the identifier in
`config/security/pip_audit_ignores.txt` (one ID per line, `#` for comments).
Provide a justification in the ticket and create a follow-up work item with an
expiry date. Example ignore file:

```
# Temporary exemption until vendor ships a patch
CVE-2024-12345
GHSA-aaaa-bbbb-cccc
```

Running the CLI with `--ignore-file config/security/pip_audit_ignores.txt` moves
these entries to the "Ignored vulnerabilities" table. Ignored items still
appear in the report so reviewers can confirm the exemption is tracked.

## Alerting

CI publishes the JSON payload via `--format json --output artifacts/security/pip_audit.json`.
Operations ingests this feed into the observability dashboard so repeated
violations trigger alerts, aligning with the encyclopedia’s security posture.
