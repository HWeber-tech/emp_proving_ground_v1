# AlphaTrade Whitepaper Draft

## Abstract
AlphaTrade operationalises a five-stage cognitive trading loop—Perception, Adaptation, Reflection, Execution, and Governance—on top of the Emporium Proving Ground codebase. The implementation pairs fast-weight policy routing with rich telemetry so paper trials remain auditable while we iterate toward live connectivity. This draft summarises the current architecture, the BDH-inspired design choices that shape the loop, and the evidence pack generated by our regression harness and paper-simulation tooling. It is intended to help reviewers trace every roadmap promise back to executable code, context packs, and guardrail tests.

## 1. Motivation & Scope
AlphaTrade follows the AlphaTrade blueprint and EMP encyclopedia guidance for a governed trading intelligence stack. The roadmap emphasises:
- ingesting institutional-quality market data into a unified belief model;【docs/context/alignment_briefs/institutional_data_backbone.md】
- adapting tactics with Hebbian fast weights and evolution hooks while preserving positive, sparse activations;【docs/context/alignment_briefs/evolution_engine.md】
- documenting outcomes through reflection artefacts and governance checks before enabling any live trading path.【docs/context/alignment_briefs/operational_readiness.md】
This whitepaper satisfies the “Documentation: AlphaTrade Whitepaper Draft” milestone by providing an architecture walkthrough, explaining the BDH-inspired behaviours already implemented, and packaging preliminary evidence from paper-mode simulations and guardrail suites.

## 2. Architecture Overview
AlphaTrade is delivered as a layered runtime. The diagram below shows the control flow that repeats on each bootstrap tick:

```
┌────────────┐    ┌─────────────┐    ┌──────────────┐    ┌────────────┐    ┌───────────────┐
│ Perception │──► │ Adaptation  │──► │ Reflection   │──► │ Execution  │──► │ Governance    │
└─────┬──────┘    └─────┬───────┘    └──────┬──────┘    └──────┬─────┘    └──────┬────────┘
      │                feedback ▲             │                 │                │
      │                       │               ▼                 │                │
      │             telemetry + diaries  ─── decision ledger ───┘        policy + ops loops
      ▼
Timescale / Cache / Kafka ingest
```

### 2.1 Stage Inventory
| Stage | Primary modules | Configuration entry points | Guardrail evidence |
| --- | --- | --- | --- |
| Perception | `src/sensory/real_sensory_organ.py`, `src/data_integration/real_data_slice.py` | `config/reflection/rim.config.example.yml` | `tests/integration/test_real_data_slice_ingest.py`, `tests/sensory/test_primary_dimension_sensors.py` |
| Adaptation | `src/understanding/router.py`, `src/thinking/adaptation/fast_weights.py`, `src/thinking/adaptation/policy_router.py` | `docs/context/examples/understanding_router.md` | `tests/understanding/test_understanding_router.py`, `tests/thinking/test_fast_weights.py` |
| Reflection | `src/understanding/decision_diary.py`, `src/thinking/adaptation/policy_reflection.py` | SystemConfig extras (`DECISION_DIARY_PATH`, `POLICY_LEDGER_PATH`), `tools/understanding/decision_diary_cli.py` | `tests/understanding/test_decision_diary.py` |
| Execution | `src/trading/trading_manager.py`, `src/trading/integration/paper_trading_api.py`, `src/trading/execution/performance_monitor.py` | `docs/CTRADER_SETUP_GUIDE.md`, runtime extras | `tests/trading/test_paper_trading_api_adapter.py`, `tests/trading/test_trading_manager_execution.py` |
| Governance | `src/governance/policy_ledger.py`, `src/operations/dry_run_audit.py`, `src/runtime/task_supervisor.py` | `config/governance/strategy_registry.yaml`, `tools/operations/final_dry_run_audit.py` | `tests/operations/test_dry_run_audit.py`, `tests/runtime/test_task_supervisor.py` |

## 3. Component Highlights
### 3.1 Perception: Sensory ingest & belief formation
- `RealSensoryOrgan` fuses WHAT/WHEN/WHY/HOW/ANOMALY organs into PSD-checked belief snapshots, annotating lineage and quality metadata for downstream consumers (`src/sensory/real_sensory_organ.py`).
- `RealDataSlice` and the ingest integration test demonstrate Timescale-backed slices can be hydrated into the organ without mocks (`src/data_integration/real_data_slice.py`, `tests/integration/test_real_data_slice_ingest.py`).
- Drift sentries (`src/trading/gating/drift_sentry_gate.py`) and anomaly detectors (`src/sensory/anomaly/basic_detector.py`) provide early warning before adaptation sees corrupted signals.

### 3.2 Adaptation: Fast-weight routing & evolution hooks
- `UnderstandingRouter` orchestrates policy routing with feature-gated fast-weight adapters and Hebbian multipliers (`src/understanding/router.py`).
- The fast-weight controller enforces non-negative, sparsity-aware multipliers and exposes metrics consumed by diagnostics and diaries (`src/thinking/adaptation/fast_weights.py`).
- Evolution hooks seed new tactics from the strategy catalogue while respecting paper-only feature flags (`src/thinking/adaptation/evolution_manager.py`, `tests/thinking/test_evolution_manager.py`).

### 3.3 Reflection: Diaries, probes, and analytics
- Decision diary entries capture the belief snapshot, policy decision, fast-weight context, and probe activations for every iteration (`src/understanding/decision_diary.py`).
- Reflection builders aggregate diaries into reviewer-friendly digests that quantify router behaviour and probe outcomes (`src/thinking/adaptation/policy_reflection.py`).
- Probe registry enforcement keeps diary metadata consistent with the documented probe definitions, and the regression suite verifies schema compliance (`src/understanding/probe_registry.py`, `tests/understanding/test_decision_diary.py`).

### 3.4 Execution: Paper integrations & throttled routing
- `TradingManager` routes intents through risk gates, release policies, and paper execution adapters (`src/trading/trading_manager.py`).
- The paper API adapter submits signed REST orders and retries transient failures; the aiohttp-based tests confirm HTTP integration, credential wiring, and error handling (`src/trading/integration/paper_trading_api.py`, `tests/trading/test_paper_trading_api_adapter.py`).
- Throughput and backlog monitors expose latency, queue depth, and throttle posture for observability dashboards (`src/trading/execution/performance_monitor.py`, `src/trading/execution/backlog_tracker.py`).

### 3.5 Governance: Policy ledger, audits, and supervision
- Policy ledgers track release approvals and attach governance metadata to each router decision (`src/governance/policy_ledger.py`).
- `dry_run_audit.py` assembles diary coverage, Sharpe thresholds, and throttled trade counts into an evidence packet that mirrors the roadmap’s governance definition of done (`src/operations/dry_run_audit.py`, `tests/operations/test_dry_run_audit.py`).
- The task supervisor ensures background ingest and monitoring tasks are registered, restarted on failure, and surfaced to operators (`src/runtime/task_supervisor.py`, `tests/runtime/test_task_supervisor.py`).

## 4. BDH-Inspired Capabilities
The BDH brief emphasises rapid adaptation, sparse positive activations, and interpretable concept graphs. AlphaTrade meets these expectations as follows:

1. **Fast-weight adaptation.** Hebbian multipliers reinforce tactics that recently performed well while exponential decay prevents runaway leverage. Regression cases assert multiplier updates obey configured floors/ceilings and remain non-negative (`tests/thinking/test_fast_weights.py`).
2. **Positive sparse activations.** The fast-weight controller prunes adapters based on percentile thresholds and clamps multipliers to maintain a small active set per tick. Diagnostics export the `%_active_strategies` metric so reviewers can verify sparsity (`src/understanding/diagnostics.py`).
3. **Interpretable strategy graphs.** Router diagnostics visualise decision graphs, activation density, and experiment lineage, letting governance link trades back to sensory evidence (`src/understanding/diagnostics.py`, `docs/context/examples/understanding_router.md`).
4. **Self-healing governance.** Policy ledger hooks and dry-run audits feed governance outcomes back into the router, automatically demoting tactics that violate policy (`src/thinking/adaptation/policy_router.py`, `src/operations/dry_run_audit.py`).

Table 1 summarises the traceability between BDH tenets and implementation artefacts.

| BDH principle | Implementation anchors | Guardrail & evidence |
| --- | --- | --- |
| Fast adaptation | `fast_weights.py`, `policy_router.py`, `tests/thinking/test_fast_weights.py` | Fast-weight update tests, diary telemetry snapshots |
| Sparse positive activations | `fast_weights.py`, `understanding/router.py`, `src/understanding/diagnostics.py` | Active-strategy counts in diagnostics, policy router regression |
| Interpretable concept graphs | `understanding/diagnostics.py`, diary reflection exports | Visualization unit tests, diary schema enforcement |
| Governance coupling | `policy_ledger.py`, `dry_run_audit.py`, `trading_manager.py` | Dry-run audit guardrails, policy ledger stage enforcement tests |

## 5. DeepScientist-lite Experimentation Loop
AlphaTrade now embeds the lightweight “DeepScientist-lite” loop to accelerate ideation while safeguarding governance. The loop
extends the Emporium experimentation tooling with a findings memory, quick evaluation gate, and upper-confidence-bound selector
so researchers can run tightly-scoped optimisation sprints without polluting the live policy backlog. Key attributes include:

- **Persistent memory.** `data/experiments.sqlite` caches idea parameters, novelty vectors, and screen/test outcomes, letting
  reviewers trace how each candidate progressed through the loop. Novelty is computed via cached parameter hashes so repeated
  runs stay fast and deterministic. (See `docs/emp_cycle.md`.)
- **Cheap screening.** `emp/core/quick_eval.py` executes a CPU-light backtest slice and derives a composite quick score. Ideas
  that fall below the configured threshold are tagged with failure notes and retained for retrospective analysis instead of
  reaching the costly full simulation step.
- **Progress governance.** `emp/cli/emp_cycle.py` exposes KPI, secondary guardrails, and timeout controls so AlphaTrade’s
  evolution sprints respect risk appetite. Reproducibility metadata (seed, Git SHA) lands in the findings memory, enabling the
  governance squad to recreate any promising candidate before promotion.
- **Maintenance tooling.** `emp/cli/emp_db_tools.py` offers prune and vacuum subcommands that keep the experimentation ledger
  lean, making it feasible to run the loop continuously alongside primary AlphaTrade rehearsals.

By co-locating the experimentation state with the broader governance evidence pack, the DeepScientist-lite loop ensures AlphaTrade
can incubate new tactics quickly while maintaining the auditable trail required for policy promotion.

## 6. Preliminary Evidence & Reproducibility
While live data ingest is still being hardened, the current toolchain produces auditable evidence for paper-mode trials:

| Evidence surface | How to reproduce | Highlights |
| --- | --- | --- |
| Paper trading simulation report | `poetry run python tools/trading/run_paper_trading_simulation.py --pretty --min-orders 1 --output artifacts/whitepaper/paper_report.json` | Generates a JSON summary of orders, errors, and ledger approvals using the runtime defaults. When run without external feeds the harness records zero orders, demonstrating safe defaults; supply a Timescale-backed feed to observe end-to-end fills. |
| Decision diary snapshot | Set `DECISION_DIARY_PATH` and run the simulation; or execute `tools/understanding/decision_diary_cli.py` with a stored policy decision payload. | Entries include belief regime, fast-weight metrics, probes, and governance annotations. Regression tests assert schema stability and probe validation. |
| Drift-to-paper governance test | `pytest tests/trading/test_trading_manager_execution.py::test_trading_manager_forces_paper_execution_under_drift_warn` | Simulated WHY-drift warning forces a paper route: risk validation runs once, the recording paper engine observes exactly one fill, and telemetry records the `forced_paper` event for governance review. |
| Paper API integration | `pytest tests/trading/test_paper_trading_api_adapter.py` | Spins up an aiohttp test server, verifies the adapter submits signed JSON orders, and asserts failures raise `PaperTradingApiError`, covering both success and retry paths. |
| Dry-run audit evidence | `poetry run python tools/operations/final_dry_run_audit.py --output artifacts/whitepaper/dry_run.json` | Produces the governance evidence bundle (coverage checks, Sharpe enforcement, throttle posture) consumed during sign-off rehearsals. |

These artefacts cover the roadmap requirement for preliminary paper-trading evidence: we can run the harness end-to-end, observe governance-safe behaviour in regression scenarios, and hand reviewers reproducible logs, even before live feeds are attached.

## 7. Roadmap Alignment & Open Work
- **Real data integration.** TimescaleDB/Kafka wiring is staged but disabled by default; completing “Operational Data Backbone Online” will swap the remaining synthetic fixtures for live feeds.
- **Performance profiling.** Throughput monitors surface processing latency, yet sustained live trials are pending. The “Performance Tuning & Throttle” task will benchmark CPU/memory usage and extend throttle coverage.
- **Paper-to-live transition.** Governance integration ensures experiments stay in paper mode until a policy ledger grants `limited_live`. Completing runtime builder supervision and the final dry-run will enable multi-day rehearsals.

## Appendix A – Context Pack Reference Map
- Perception alignment brief: `docs/context/alignment_briefs/sensory_cortex.md`
- Institutional data backbone: `docs/context/alignment_briefs/institutional_data_backbone.md`
- Evolution engine plan: `docs/context/alignment_briefs/evolution_engine.md`
- Operational readiness: `docs/context/alignment_briefs/operational_readiness.md`
- Quality & observability charter: `docs/context/alignment_briefs/quality_observability.md`

## Appendix B – Suggested Review Commands
1. `poetry run pytest tests/trading/test_paper_trading_api_adapter.py`
2. `poetry run pytest tests/trading/test_trading_manager_execution.py -k forced_paper`
3. `poetry run python tools/trading/run_paper_trading_simulation.py --diary artifacts/whitepaper/decision_diary.json --ledger artifacts/whitepaper/policy_ledger.json --pretty`

Running the commands above recreates the evidence cited in this whitepaper. They provide reproducible proof that AlphaTrade’s paper loop respects BDH design principles, enforces governance, and is ready for the remaining roadmap milestones.
